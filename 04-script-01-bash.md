# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

### Цель задания

В результате выполнения этого задания вы:

1. Познакомитесь с командной оболочкой Bash.
2. Используете синтаксис bash-скриптов.
3. Узнаете, как написать скрипт в файл так, чтобы он мог выполниться с параметрами и без.


### Чеклист готовности к домашнему заданию

1. У вас настроена виртуальная машина/контейнер/установлена гостевая ОС семейств Linux, Unix, MacOS.
2. Установлен Bash.


### Инструкция к заданию

1. Скопируйте в свой .md-файл содержимое этого файла; исходники можно посмотреть [здесь](https://raw.githubusercontent.com/netology-code/sysadm-homeworks/devsys10/04-script-01-bash/README.md).
2. Заполните недостающие части документа решением задач (заменяйте `???`, остальное в шаблоне не меняйте, чтобы не сломать форматирование текста, подсветку синтаксиса). Вместо логов можно вставить скриншоты по желанию.
3. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
4. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.

------

## Задание 1

Есть скрипт:
```bash
a=1
b=2
c=a+b
d=$a+$b
e=$(($a+$b))
```

Какие значения переменным c,d,e будут присвоены? Почему?

| Переменная  | Значение | Обоснование |
| ------------- | ------------- | ------------- |
| `c`  | a+b  | Была выполнена конкатенация строковых символов `a` и `b`, а не значения переменных. |
| `d`  | 1+2  | Была выполнена конкатенация значений переменных `a` и `b` как строк, а не арифметическая операция. |
| `e`  | 3  | Конструкция с двойными круглыми скобками позволяет вычислять арифметические операции, в частности произведет сложение  целочисленных значений переменных `a` и `b`. |

----

## Задание 2

На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным (после чего скрипт должен завершиться). В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
```bash
while ((1==1)
do
	curl https://localhost:4757
	if (($? != 0))
	then
		date >> curl.log
	fi
done
```

### Ваш скрипт:
```bash
#!/usr/bin/env bash
while ((1==1)
do
  curl https://localhost:4757
  if (($? != 0))
  then
    date >> curl.log
  else
    break
  fi
done
```

---

## Задание 3

Необходимо написать скрипт, который проверяет доступность трёх IP: `192.168.0.1`, `173.194.222.113`, `87.250.250.242` по `80` порту и записывает результат в файл `log`. Проверять доступность необходимо пять раз для каждого узла.

### Ваш скрипт:
```bash
#!/usr/bin/env bash

CHECK_IP_LIST=("192.168.0.1" "173.194.222.113" "87.250.250.242")
CHECK_TCP_PORT="80"
LOG_PATH="/tmp/check_ip.log"
CHECK_COUNT=5

echo "$(date +%H:%M:%S-%d.%m.%y)-----Start script-----" > $LOG_PATH

for ip in ${CHECK_IP_LIST[@]}
do
  loop_count=${CHECK_COUNT}
  while ((${loop_count} > 0 ))
  do
      nc -w 10 ${ip} ${CHECK_TCP_PORT}
      if (($? == 0))
      then
        echo "$(date +%H:%M:%S-%d.%m.%y)-----IP: ${ip} Check Status: PASS" >> $LOG_PATH
      else
        echo "$(date +%H:%M:%S-%d.%m.%y)-----IP: ${ip} Check Status: FAIL" >> $LOG_PATH
      fi
    let "loop_count -= 1"
  done
done
```

---
## Задание 4

Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается.

### Ваш скрипт:
```bash
#!/usr/bin/env bash

CHECK_IP_LIST=("192.168.0.1" "127.0.0.1" "173.194.222.113" "87.250.250.242")
CHECK_TCP_PORT="80"
LOG_PATH="/tmp/check_ip.log"
ERR_LOG_PATH="/tmp/check_ip_err.log"
CHECK_COUNT=5

echo "$(date +%H:%M:%S-%d.%m.%y)-----Start script-----" > $LOG_PATH

while ((1==1))
do
  for ip in ${CHECK_IP_LIST[@]}
  do
    loop_count=${CHECK_COUNT}
    while ((${loop_count} > 0 ))
    do
        nc -w 10 ${ip} ${CHECK_TCP_PORT}
        if (($? == 0))
        then
          echo "$(date +%H:%M:%S-%d.%m.%y)-----IP: ${ip} Check Status: PASS" >> $LOG_PATH
        else
          echo "$(date +%H:%M:%S-%d.%m.%y)-----IP: ${ip} Check Status: FAIL" >> $LOG_PATH
          echo "$(date +%H:%M:%S-%d.%m.%y)-----ERR IP: ${ip} Check Status: FAIL" >> $ERR_LOG_PATH
          exit 1
        fi
      let "loop_count -= 1"
    done
  done
done
```

---
